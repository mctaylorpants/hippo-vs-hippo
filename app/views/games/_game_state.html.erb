<%= turbo_frame_tag "game_state" do %>
  <% if game.winner?(current_player) %>
    <h1 class="text-center text-purple-500">
      YOU WIN!
    </h1>
    <p class="text-center">
      <%= game.display_result %>
    </p>
  <% end %>

  <% if game.winner?(challenger) %>
    <h1 class="text-center text-blue-500">
      YOU LOSE!
    </h1>
  <% end %>


  <div class="flex items-center ml-4 mr-4 p-2 <%= game.winner?(current_player) && "bg-gradient-to-l from-yellow-50 to-yellow-200" %>">
    <div class="shrink-0 rounded-2xl border border-2 border-purple-500 bg-[url('/hippo01.jpg')] bg-center bg-no-repeat bg-contain w-24 h-24"></div>
    <p class="text-gray-500 p-4">
      <%= current_player %> (you)

      <% if game.choice_for(current_player).present? %>
        <br />

        <span class="text-purple-500">
          <em>
            <%= game.choice_for(current_player) %>
          </em>
        </span>
      <% end %>
    </p>
  </div>

  <div class="flex items-center ml-4 mr-4 mt-4 p-2 mb-4 <%= game.winner?(challenger) && "bg-gradient-to-l from-yellow-50 to-yellow-200" %>">
    <p class="text-gray-500 p-4">
      <%= challenger %>

      <% if game.choice_for(challenger).present? %>
        <br />

        <span class="text-blue-500">
          <em>
            move chosen!
          </em>
        </span>
      <% end %>
    </p>
    <div class="shrink-0 rounded-2xl border border-2 border-blue-500 bg-[url('/hippo02.jpg')] bg-center bg-no-repeat bg-contain w-24 h-24"></div>
  </div>

  <% case game.current_state %>
  <% when :awaiting_opponent %>
    <h3>Waiting for opponent...</h3>

    <% if !game.host?(current_player) %>
      <h2>Join the game as <%= current_user_name %></h2>

      <%= form_tag "/games/#{game.id}/join", method: :post do %>
        <%= submit_tag "Join game" %>
      <% end %>
    <% end %>

  <% when :awaiting_choices %>

    <% if game.current_state == :awaiting_choices %>
      <p class="text-gray-500 text-center">make your move:</p>
      <div class="flex justify-center">
        <div class="rounded-lg bg-purple-200 p-1 m-1">
          <%= link_to "charge!", "/games/#{game.id}/choose?choice=charge", data: { turbo_method: :post } %>
        </div>

        <div class="rounded-lg bg-blue-200 p-1 m-1">
          <%= link_to "submerge!", "/games/#{game.id}/choose?choice=submerge", data: { turbo_method: :post } %>
        </div>

        <div class="rounded-lg bg-orange-200 p-1 m-1">
          <%= link_to "chomp!", "/games/#{game.id}/choose?choice=chomp", data: { turbo_method: :post } %>
        </div>
      </div>
    <% end %>
  <% end %>
<% end %>
